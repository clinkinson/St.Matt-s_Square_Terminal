<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order History</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-zinc-950 p-6 text-white">
<div class="flex justify-between items-center mb-6 border-b border-zinc-800 pb-4">
    <h1 class="text-3xl font-bold">Order History <span class="text-sm font-normal text-zinc-500">(Last 20)</span></h1>
    <a href="/barista.html" class="bg-zinc-800 hover:bg-zinc-700 px-4 py-2 rounded-md text-sm transition border border-zinc-700">← Back to Active</a>
</div>

<div id="history-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 opacity-80">
</div>

<script>
    const socket = io();

    socket.on('history-init', (data) => renderHistory(data.completedOrders));
    socket.on('history-update', (data) => renderHistory(data.completedOrders));

    function renderHistory(completedOrders) {
        const grid = document.getElementById('history-grid');
        if (completedOrders.length === 0) {
            grid.innerHTML = `<div class="col-span-full text-center text-zinc-600 mt-10">No completed orders yet.</div>`;
            return;
        }

        grid.innerHTML = completedOrders.map(order => `
                <div class="bg-zinc-900 border border-zinc-700 rounded-lg p-4 flex flex-col h-full grayscale-[0.5]">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-zinc-400 text-lg font-bold truncate">${order.customerName}</div>
                        <span class="text-[10px] text-zinc-600 font-mono uppercase">Done: ${order.completedAt}</span>
                    </div>

                    <div class="flex-grow text-sm text-zinc-500 border-t border-zinc-800 pt-3">
                        ${order.items.map(item => `<div>• ${item.name}</div>`).join('')}
                    </div>

                    <button onclick="restoreOrder(${order.id})"
                        class="mt-4 bg-orange-900/30 hover:bg-orange-800 text-orange-200 text-xs py-2 rounded border border-orange-800/50 transition">
                        RETORE TO ACTIVE
                    </button>
                </div>
            `).join('');
    }

    function restoreOrder(id) {
        socket.emit('restore-order', id);
    }
</script>
</body>
</html>